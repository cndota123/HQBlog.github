<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>shiro-spring自定义filter | HQ BLOG</title><meta name="description" content="最近在项目中使用了shiro作为security框架配合spring使用，这是第一次使用shiro，总体感觉上shiro相对spring security功能上更简洁清晰，不过同样没有spring security那样直接接入即用，shiro需要自己定义其中各个部件的实现，但是实现起来也很简单。 springboot整合shiro下面给的例子基于spring-boot-web整合shiro，pom"><meta name="keywords" content="java,spring,security,shiro"><meta name="author" content="HuangQiang"><meta name="copyright" content="HuangQiang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/09/05/shiro%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="shiro-spring自定义filter"><meta property="og:url" content="http://yoursite.com/2020/09/05/shiro%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F/"><meta property="og:site_name" content="HQ BLOG"><meta property="og:description" content="最近在项目中使用了shiro作为security框架配合spring使用，这是第一次使用shiro，总体感觉上shiro相对spring security功能上更简洁清晰，不过同样没有spring security那样直接接入即用，shiro需要自己定义其中各个部件的实现，但是实现起来也很简单。 springboot整合shiro下面给的例子基于spring-boot-web整合shiro，pom"><meta property="og:image" content="https://i.loli.net/2020/09/06/1wgrbldpGcPK82A.jpg"><meta property="article:published_time" content="2020-09-05T14:01:14.000Z"><meta property="article:modified_time" content="2020-09-08T09:55:56.553Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-08 17:55:56'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">33</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/Gallery"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88shiro"><span class="toc-number">1.</span> <span class="toc-text">springboot整合shiro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88shiro%EF%BC%8Cjwt"><span class="toc-number">2.</span> <span class="toc-text">springboot整合shiro，jwt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88shiro%EF%BC%8Cjwt%EF%BC%8Credis"><span class="toc-number">3.</span> <span class="toc-text">springboot整合shiro，jwt，redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88shiro%EF%BC%8Cjwt%EF%BC%8Credis%E7%AE%80%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">springboot整合shiro，jwt，redis简化</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/09/06/1wgrbldpGcPK82A.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HQ BLOG</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/Gallery"><i class="fa-fw fas fa-images"></i><span> Gallery</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">shiro-spring自定义filter</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-09-05T14:01:14.000Z" title="发表于 2020-09-05 22:01:14">2020-09-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-09-08T09:55:56.553Z" title="更新于 2020-09-08 17:55:56">2020-09-08</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>最近在项目中使用了shiro作为security框架配合spring使用，这是第一次使用shiro，总体感觉上shiro相对spring security功能上更简洁清晰，不过同样没有spring security那样直接接入即用，shiro需要自己定义其中<br>各个部件的实现，但是实现起来也很简单。</p>
<h3 id="springboot整合shiro"><a href="#springboot整合shiro" class="headerlink" title="springboot整合shiro"></a>springboot整合shiro</h3><p>下面给的例子基于spring-boot-web整合shiro，pom.xml文件所需依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shiro-spring&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.5.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>第一步就是创建自己的Realm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.apache.shiro.authc.AuthenticationException;</span><br><span class="line">import org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line">import org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line">import org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line">import org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line">import org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line">import org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line">import org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:08 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class MyRealm extends AuthorizingRealm &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserDao userDao;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">        String username &#x3D; (String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        User user &#x3D; userDao.getUserByName(username);</span><br><span class="line">        SimpleAuthorizationInfo simpleAuthorizationInfo &#x3D; new SimpleAuthorizationInfo();</span><br><span class="line">        Arrays.stream(user.getRoles().split(&quot;,&quot;)).forEach(simpleAuthorizationInfo::addRole);</span><br><span class="line">        Arrays.stream(user.getPermissions().split(&quot;,&quot;)).forEach(simpleAuthorizationInfo::addStringPermission);</span><br><span class="line">        return simpleAuthorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException &#123;</span><br><span class="line">        if (authenticationToken.getPrincipal() &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            String username &#x3D; authenticationToken.getPrincipal().toString();</span><br><span class="line">            User user &#x3D; userDao.getUserByName(username);</span><br><span class="line">            return new SimpleAuthenticationInfo(username,user.getPassword(),getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyRealm继承自AuthorizingRealm，实现了doGetAuthorizationInfo和doGetAuthenticationInfo方法，简单说下这两个方法的作用</p>
<ul>
<li>doGetAuthenticationInfo:<br>  AuthenticationToken记录了当前登录用户的信息，你可以在这个方法中进行进一步处理然后生成AuthenticationInfo信息</li>
<li>doGetAuthorizationInfo:<br>  PrincipalCollection记录了当前用户验证之后生成的信息，你可以做进一步处理，一般添加role和perm生成AuthorizationInfo，其实观察SimpleAuthenticationInfo的构造方法可以得知PrincipalCollection是根据AuthenticationInfo生成的</li>
</ul>
<p>另外UserDao是查询user信息的接口，你可以根据实际来实现，这里简单起见只是直接生成的.</p>
<p>UserDao:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:14 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span class="line">public class UserDao &#123;</span><br><span class="line"></span><br><span class="line">    public User getUserByName(String username) &#123;</span><br><span class="line">        if (username.equals(&quot;admin&quot;)) &#123;</span><br><span class="line">            return new User(&quot;admin&quot;,&quot;123456&quot;,&quot;admin&quot;,&quot;admin&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return new User(&quot;user&quot;,&quot;123456&quot;,&quot;normal&quot;,&quot;normal&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>User:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:11 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private String roles;</span><br><span class="line">    private String permissions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后就是shiro的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.apache.shiro.mgt.SecurityManager;</span><br><span class="line">import org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line">import org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line">import org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:38 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class ShiroConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() &#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator defaultAAP &#x3D; new DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        defaultAAP.setProxyTargetClass(true);</span><br><span class="line">        return defaultAAP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MyRealm myRealm() &#123;</span><br><span class="line">        return new MyRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SecurityManager securityManager(MyRealm myRealm) &#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager &#x3D; new DefaultWebSecurityManager();</span><br><span class="line">        securityManager.setRealm(myRealm);</span><br><span class="line">        return securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) &#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean &#x3D; new ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        &#x2F;&#x2F; 注意filterChainDefinitionMap必须是有序的,不然不一定按你预想的次序工作</span><br><span class="line">        Map&lt;String,String&gt; filterChainDefinitionMap &#x3D; new LinkedHashMap&lt;&gt;();</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;login&quot;,&quot;anon&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;role&quot;,&quot;roles[admin]&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;perms&quot;,&quot;perms[admin]&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;**&quot;,&quot;authc&quot;);</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        return shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DefaultAdvisorAutoProxyCreator这个bean说明下，我自己的项目没有添加这个bean时使用事务提示缺少这个bean，但是这个bean又有二次代理的问题，因此推荐@ConditionalOnMissingBean来实现.</p>
<p>ShiroFilterFactoryBean中我添加了一些路径相关设置来测试shiro原生提供的一些关于权限控制的功能，这些功能的实现依赖于shiro的原生filter，这些配置也可以用注解来实现不过要添加一个bean:AuthorizationAttributeSourceAdvisor<br>关于原生filter和配置中参数的解释如下:</p>
<table>
<thead>
<tr>
<th>filter</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>anon</td>
<td>不进行权限验证</td>
</tr>
<tr>
<td>authc</td>
<td>需要权限验证</td>
</tr>
<tr>
<td>logout</td>
<td>注销，执行后会直接跳转到<code>shiroFilterFactoryBean.setLoginUrl()</code>设置的 url</td>
</tr>
<tr>
<td>authcBasic</td>
<td>进行httpBasic认证</td>
</tr>
<tr>
<td>user</td>
<td>表示必须存在用户，当登入操作时不做检查</td>
</tr>
<tr>
<td>ssl</td>
<td>表示安全的URL请求,协议为 https</td>
</tr>
<tr>
<td>perms[params]</td>
<td>需要对应权限，例如perms[“admin:get”],perms[“admin,user”],多个参数时所有权限都得满足，:可以用来控制http method</td>
</tr>
<tr>
<td>roles[params]</td>
<td>需要对应角色，基本同perms</td>
</tr>
<tr>
<td>rest[params]</td>
<td>需要对应http method</td>
</tr>
<tr>
<td>port[params]</td>
<td>port[8080],当端口不是8080时跳转到schemal://host:8080?requestParams</td>
</tr>
</tbody></table>
<p>controller:/login中基于shiro的login来进行登录，默认的实现在登录之后通过seesion来记录当前用户的登陆信息，如果你想加入自己逻辑可以在login方法执行前之前进行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.test.controller;</span><br><span class="line"></span><br><span class="line">import com.test.shiro.User;</span><br><span class="line">import com.test.shiro.UserDao;</span><br><span class="line">import org.apache.shiro.SecurityUtils;</span><br><span class="line">import org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:50 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">public class Controller &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserDao userDao;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">    public String login(String username) &#123;</span><br><span class="line">        User user &#x3D; userDao.getUserByName(username);</span><br><span class="line">        UsernamePasswordToken usernamePasswordToken &#x3D; new UsernamePasswordToken(user.getUsername(),user.getPassword());</span><br><span class="line">        SecurityUtils.getSubject().login(usernamePasswordToken);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;test&#x2F;role&quot;)</span><br><span class="line">    public String roleTest() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;test&#x2F;perms&quot;)</span><br><span class="line">    public String perms() &#123;</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;query&quot;)</span><br><span class="line">    public String query() &#123;</span><br><span class="line">        return &quot;query success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果:<br>首先用admin来登录<br>\login:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;login?username&#x3D;admin HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 882a86f7-bc59-1aad-4e03-55c631a51869</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">success</span><br></pre></td></tr></table></figure>
<p>\test\role</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;test&#x2F;role HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: d9beb9c4-4e14-7d94-dabe-31fecb8d6cd7</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<p>\test\perms</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;test&#x2F;perms HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: c0fd4474-0ca8-76df-3cba-fddc20a09a9e</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<p>\query</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;query HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: c9f1eee3-15f9-d64a-f797-c746b4d29733</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">query success</span><br></pre></td></tr></table></figure>

<p>接下来用user进行登录，结果和admin一样的接口就不列出来了</p>
<p>\test\role</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;test&#x2F;role HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 667cf11c-3735-e413-4f0f-84340d755f79</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">&#123;</span><br><span class="line">    &quot;timestamp&quot;: &quot;2020-09-06T03:44:28.282+00:00&quot;,</span><br><span class="line">    &quot;status&quot;: 401,</span><br><span class="line">    &quot;error&quot;: &quot;Unauthorized&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;&#x2F;test&#x2F;role&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>\test\perms</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">\\request</span><br><span class="line">GET &#x2F;test&#x2F;perms HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 46f8de51-994e-d301-ae6f-1f07845c742c</span><br><span class="line"></span><br><span class="line">\\response</span><br><span class="line">&#123;</span><br><span class="line">    &quot;timestamp&quot;: &quot;2020-09-06T03:45:24.822+00:00&quot;,</span><br><span class="line">    &quot;status&quot;: 401,</span><br><span class="line">    &quot;error&quot;: &quot;Unauthorized&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;&#x2F;test&#x2F;perms&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>明显看到user因为没有admin的权限和角色因此访问失败了，写到这里终于要开始本文主题了添加自定义的filter，目前JWT使用比较广泛我们就采取JWT来做安全认证</p>
<h3 id="springboot整合shiro，jwt"><a href="#springboot整合shiro，jwt" class="headerlink" title="springboot整合shiro，jwt"></a>springboot整合shiro，jwt</h3><p>首先自定义一个filter:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import com.test.util.JWTUtils;</span><br><span class="line">import org.apache.shiro.web.filter.authz.AuthorizationFilter;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 11:56 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JWTFilter extends AuthorizationFilter &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected boolean isAccessAllowed(ServletRequest servletRequest, ServletResponse servletResponse, Object o) throws Exception &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws IOException &#123;</span><br><span class="line">        if (((HttpServletRequest)request).getHeader(&quot;jwtAuth&quot;) !&#x3D; null) &#123;</span><br><span class="line">            String token &#x3D; ((HttpServletRequest) request).getHeader(&quot;jwtAuth&quot;);</span><br><span class="line">            String username &#x3D; JWTUtils.parseJwt(token);</span><br><span class="line">            JWTToken jwtToken &#x3D; new JWTToken(username,token);</span><br><span class="line">            getSubject(request, response).login(jwtToken);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JWTFilter实现了isAccessAllowed，onAccessDenied前者是判断是否允许访问返回false时调用onAccessDenied，后者在<code>getSubject(request, response).login(jwtToken)</code>中调用了realm的验证方法，在这个项目中就是MyRealm的doGetAuthenticationInfo</p>
<p>JWTToken:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 12:48 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JWTToken implements AuthenticationToken &#123;</span><br><span class="line"></span><br><span class="line">    private String username;</span><br><span class="line">    private String token;</span><br><span class="line"></span><br><span class="line">    public JWTToken(String username, String token) &#123;</span><br><span class="line">        this.username &#x3D; username;</span><br><span class="line">        this.token &#x3D; token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getPrincipal() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getCredentials() &#123;</span><br><span class="line">        return token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JWTUtils:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.test.util;</span><br><span class="line"></span><br><span class="line">import io.jsonwebtoken.JwtBuilder;</span><br><span class="line">import io.jsonwebtoken.Jwts;</span><br><span class="line">import io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 11:56 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JWTUtils &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static String getToken(String username) &#123;</span><br><span class="line">        JwtBuilder builder &#x3D; Jwts.builder().setId(&quot;ee15qs&quot;)</span><br><span class="line">                .setSubject(username)</span><br><span class="line">                .setIssuedAt(new Date())</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, &quot;qpHelWDTbhXs9jTL7neOZd0k8UxvkAqp&quot;)</span><br><span class="line">                .setExpiration(new Date(System.currentTimeMillis() + 1000 * 30));</span><br><span class="line">        return builder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String parseJwt(String token) &#123;</span><br><span class="line">        return Jwts.parser().setSigningKey(&quot;asf15ws&quot;)</span><br><span class="line">                .parseClaimsJwt(token)</span><br><span class="line">                .getBody().getSubject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">jwt基于jjwt实现，pom.xml依赖新增:</span><br></pre></td></tr></table></figure>
<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
        &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
        &lt;version&gt;0.9.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;
        &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;
        &lt;version&gt;2.3.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;
        &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt;
        &lt;version&gt;2.3.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;
        &lt;artifactId&gt;jaxb-core&lt;/artifactId&gt;
        &lt;version&gt;2.3.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;javax.activation&lt;/groupId&gt;
        &lt;artifactId&gt;activation&lt;/artifactId&gt;
        &lt;version&gt;1.1.1&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后面四个依赖是因为我本地jdk版本太高(jdk11)会报&#96;java.lang.ClassNotFoundException: javax.xml.bind.DatatypeConverter&#96;这个报错，jdk8及以下应该没问题</span><br></pre></td></tr></table></figure>
<p>ShiroConfig的修改:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) &#123;</span><br><span class="line">    ShiroFilterFactoryBean shiroFilterFactoryBean &#x3D; new ShiroFilterFactoryBean();</span><br><span class="line">    shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">    Map&lt;String, Filter&gt; filterMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    &#x2F;&#x2F; 注意这里的JwtFilter不能使用spring的bean来注入，否则会使shiro默认的Filter失效</span><br><span class="line">    filterMap.put(&quot;jwt&quot;, new JWTFilter());</span><br><span class="line">    shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class="line">    &#x2F;&#x2F; 注意filterChainDefinitionMap必须是有序的,不然不一定按你预想的次序工作</span><br><span class="line">    Map&lt;String, String&gt; filterChainDefinitionMap &#x3D; new LinkedHashMap&lt;&gt;();</span><br><span class="line">    filterChainDefinitionMap.put(&quot;&#x2F;login&quot;, &quot;anon&quot;);</span><br><span class="line">    filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;role&quot;, &quot;roles[admin]&quot;);</span><br><span class="line">    filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;perms&quot;, &quot;perms[admin]&quot;);</span><br><span class="line">    filterChainDefinitionMap.put(&quot;&#x2F;**&quot;, &quot;jwt&quot;);</span><br><span class="line">    shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">    return shiroFilterFactoryBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyRealm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.apache.shiro.authc.AuthenticationException;</span><br><span class="line">import org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line">import org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line">import org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line">import org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line">import org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line">import org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line">import org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:08 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class MyRealm extends AuthorizingRealm &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    UserDao userDao;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 解决UnsupportedTokenException异常,不过应该有别的解决方案</span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(AuthenticationToken token) &#123;</span><br><span class="line">        return token instanceof JWTToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">        String username &#x3D; (String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">        User user &#x3D; userDao.getUserByName(username);</span><br><span class="line">        SimpleAuthorizationInfo simpleAuthorizationInfo &#x3D; new SimpleAuthorizationInfo();</span><br><span class="line">        Arrays.stream(user.getRoles().split(&quot;,&quot;)).forEach(simpleAuthorizationInfo::addRole);</span><br><span class="line">        Arrays.stream(user.getPermissions().split(&quot;,&quot;)).forEach(simpleAuthorizationInfo::addStringPermission);</span><br><span class="line">        return simpleAuthorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken authenticationToken) throws AuthenticationException &#123;</span><br><span class="line">        if (authenticationToken.getPrincipal() &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            String username &#x3D; authenticationToken.getPrincipal().toString();</span><br><span class="line">            User user &#x3D; userDao.getUserByName(username);</span><br><span class="line">            return new SimpleAuthenticationInfo(username, authenticationToken.getCredentials(), getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>controller的修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;&#x2F;login&quot;)</span><br><span class="line">public String login(String username) &#123;</span><br><span class="line">    return JWTUtils.getToken(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下<br>\login</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;request</span><br><span class="line">GET &#x2F;login?username&#x3D;admin HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 9ccaee74-a2b6-532d-0fd9-85b1814c30ae</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;response</span><br><span class="line">eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJlZTE1cXMiLCJzdWIiOiJhZG1pbiIsImlhdCI6MTU5OTM3MDM3OSwiZXhwIjoxNTk5MzcwNDA5fQ.gKKB49SiEW5omkZdkmcQrsiW9cQHrwEX-JdSWbNWyEE</span><br></pre></td></tr></table></figure>

<p>\query</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;request</span><br><span class="line">GET &#x2F;query HTTP&#x2F;1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">jwtAuth: eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJlZTE1cXMiLCJzdWIiOiJhZG1pbiIsImlhdCI6MTU5OTM3MDM3OSwiZXhwIjoxNTk5MzcwNDA5fQ.gKKB49SiEW5omkZdkmcQrsiW9cQHrwEX-JdSWbNWyEE</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Postman-Token: 963f7b5f-a185-d60e-29f3-33dbb06b80fd</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;response</span><br><span class="line">query success</span><br></pre></td></tr></table></figure>

<h3 id="springboot整合shiro，jwt，redis"><a href="#springboot整合shiro，jwt，redis" class="headerlink" title="springboot整合shiro，jwt，redis"></a>springboot整合shiro，jwt，redis</h3><p>不过之前的方案中token在项目重启之后就无效了，正常项目中需要对jwt进行持久化处理，下面提供接入redis来进行token的持久化，实现起来也很简单</p>
<p>首先添加shiro-redis依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.crazycake&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shiro-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>ShiroConfig中添加redis配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">package com.test.shiro;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.collections.map.HashedMap;</span><br><span class="line">import org.apache.shiro.mgt.SecurityManager;</span><br><span class="line">import org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line">import org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line">import org.apache.shiro.web.session.mgt.DefaultWebSessionManager;</span><br><span class="line">import org.crazycake.shiro.RedisCacheManager;</span><br><span class="line">import org.crazycake.shiro.RedisManager;</span><br><span class="line">import org.crazycake.shiro.RedisSessionDAO;</span><br><span class="line">import org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import javax.servlet.Filter;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @Author: ClancyH</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Create in 10:38 2020&#x2F;9&#x2F;6</span><br><span class="line"> * @Modify BY:</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class ShiroConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() &#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator defaultAAP &#x3D; new DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        defaultAAP.setProxyTargetClass(true);</span><br><span class="line">        return defaultAAP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MyRealm myRealm() &#123;</span><br><span class="line">        return new MyRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisManager redisManager() &#123;</span><br><span class="line">        &#x2F;&#x2F; 使用默认的shiro redisManager配置也可以按需求定制</span><br><span class="line">        return new RedisManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisCacheManager cacheManager(RedisManager redisManager) &#123;</span><br><span class="line">        RedisCacheManager redisCacheManager &#x3D; new RedisCacheManager();</span><br><span class="line">        redisCacheManager.setRedisManager(redisManager);</span><br><span class="line">        return redisCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisSessionDAO redisSessionDAO(RedisManager redisManager) &#123;</span><br><span class="line">        RedisSessionDAO redisSessionDAO &#x3D; new RedisSessionDAO();</span><br><span class="line">        redisSessionDAO.setRedisManager(redisManager);</span><br><span class="line">        return redisSessionDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SecurityManager securityManager(MyRealm myRealm, RedisCacheManager redisCacheManager, RedisSessionDAO redisSessionDAO) &#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager &#x3D; new DefaultWebSecurityManager();</span><br><span class="line">        securityManager.setRealm(myRealm);</span><br><span class="line">        securityManager.setCacheManager(redisCacheManager);</span><br><span class="line">        DefaultWebSessionManager defaultWebSessionManager &#x3D; new DefaultWebSessionManager();</span><br><span class="line">        defaultWebSessionManager.setSessionDAO(redisSessionDAO);</span><br><span class="line">        securityManager.setSessionManager(defaultWebSessionManager);</span><br><span class="line">        return securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) &#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean &#x3D; new ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        Map&lt;String, Filter&gt; filterMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 注意这里的JwtFilter不能使用spring的bean来注入，否则会使shiro默认的Filter失效</span><br><span class="line">        filterMap.put(&quot;jwt&quot;, new JWTFilter());</span><br><span class="line">        shiroFilterFactoryBean.setFilters(filterMap);</span><br><span class="line">        &#x2F;&#x2F; 注意filterChainDefinitionMap必须是有序的,不然不一定按你预想的次序工作</span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap &#x3D; new LinkedHashMap&lt;&gt;();</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;login&quot;, &quot;anon&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;role&quot;, &quot;roles[admin]&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;test&#x2F;perms&quot;, &quot;perms[admin]&quot;);</span><br><span class="line">        filterChainDefinitionMap.put(&quot;&#x2F;**&quot;, &quot;jwt&quot;);</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        return shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="springboot整合shiro，jwt，redis简化"><a href="#springboot整合shiro，jwt，redis简化" class="headerlink" title="springboot整合shiro，jwt，redis简化"></a>springboot整合shiro，jwt，redis简化</h4><p>另外还可以使用Shiro-Redis-Spring-Boot-Starter来简化一些配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.crazycake&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shiro-redis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>添加了这个依赖之后ShirConfig中的RedisManager，RedisCacheManager，RedisSessionDAO都会自动配置好，只需要在项目配置文件中配置好redis的连接配置就行了</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">HuangQiang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/09/05/shiro%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F/">http://yoursite.com/2020/09/05/shiro%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">HQ BLOG</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/spring/">spring</a><a class="post-meta__tags" href="/tags/security/">security</a><a class="post-meta__tags" href="/tags/shiro/">shiro</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/09/06/1wgrbldpGcPK82A.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2019/02/03/Java%E7%9A%84%E6%9E%9A%E4%B8%BE/"><img class="next-cover" src="/null" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">java的枚举</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2017/11/17/AutoWired异常/" title="AutoWired异常"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-11-17</div><div class="title">AutoWired异常</div></div></a></div><div><a href="/2018/01/02/Spring-aop/" title="Spring-aop"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-01-02</div><div class="title">Spring-aop</div></div></a></div><div><a href="/2017/10/26/JAVA类加载器/" title="JAVA类加载器"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-26</div><div class="title">JAVA类加载器</div></div></a></div><div><a href="/2019/01/24/Java中的Clone/" title="Java中的Clone"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-01-24</div><div class="title">Java中的Clone</div></div></a></div><div><a href="/2018/09/03/Java-NIO/" title="Java NIO"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-09-03</div><div class="title">Java NIO</div></div></a></div><div><a href="/2019/01/23/Java函数式编程/" title="Java函数式编程"><img class="cover" src="/null"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-01-23</div><div class="title">Java函数式编程</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2020 By HuangQiang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, this is hq's blog</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>